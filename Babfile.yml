tasks:
  build:
    desc: Build the bab binary
    run:
      - cmd: go build -o bab .

  install:
    desc: Install bab to $GOPATH/bin
    run:
      - cmd: go install .

  deps:
    desc: Download and tidy dependencies
    run:
      - cmd: go mod download
      - cmd: go mod tidy

  clean:
    desc: Clean build artifacts and generated files
    run:
      - cmd: go clean -cache

  check:
    desc: Run all checks that CI runs (lint, test with race)
    deps: [lint, test:race]

  fix:
    desc: Auto-fix everything (format + lint:fix)
    deps: [format, lint:fix]

  dev:
    desc: Build and run bab in one command
    deps: [build]
    run:
      - cmd: ./bab

  test:
    default:
      desc: Run tests with coverage
      run:
        - cmd: go test -v -coverprofile=coverage.txt -covermode=atomic ./...
    race:
      desc: Run tests with race detector (matches CI)
      run:
        - cmd: go test -v -race -coverprofile=coverage.txt -covermode=atomic ./...

  coverage:
    desc: Generate and open HTML coverage report
    run:
      - cmd: go test -coverprofile=coverage.txt ./...
      - cmd: go tool cover -html=coverage.txt -o coverage.html

  lint:
    default:
      desc: Run golangci-lint (matches CI)
      run:
        - cmd: golangci-lint run --config=.golangci.yaml --timeout=5m
    fix:
      desc: Run golangci-lint and auto-fix issues
      run:
        - cmd: golangci-lint run --config=.golangci.yaml --timeout=5m --fix

  format:
    default:
      desc: Format code with gofmt
      run:
        - cmd: gofmt -w .
    check:
      desc: Check if code is formatted correctly
      run:
        - cmd: gofmt -l .

  hooks:
    install:
      desc: Install git hooks via lefthook
      run:
        - cmd: lefthook install
    uninstall:
      desc: Uninstall git hooks
      run:
        - cmd: lefthook uninstall
