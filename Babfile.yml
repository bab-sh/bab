tasks:
  build:
    desc: Build the bab binary
    run:
      - log: Building bab binary...
      - cmd: go build -o bab .
      - log: Build complete

  install:
    desc: Install bab to $GOPATH/bin
    run:
      - log: Installing bab to $GOPATH/bin...
      - cmd: go install .

  schema:
    desc: generate the babfile schema json
    run:
      - cmd: ./scripts/schema.sh

  deps:
    desc: Download and tidy dependencies
    run:
      - cmd: go mod download
      - cmd: go mod tidy

  clean:
    desc: Clean build artifacts and generated files
    run:
      - cmd: go clean -cache

  check:
    desc: Run all checks that CI runs (lint, test with race)
    run:
      - log: Running CI checks...
      - task: lint
      - task: test:race
      - log: All checks passed

  fix:
    desc: Auto-fix everything (format + lint:fix)
    run:
      - log: Auto-fixing code issues...
        level: warn
      - task: format
      - task: lint:fix

  dev:
    desc: Build and run bab in one command
    deps: [build]
    run:
      - cmd: ./bab

  test:
    desc: Run tests with coverage
    run:
      - cmd: go test -v -coverprofile=coverage.txt -covermode=atomic ./...

  test:race:
    desc: Run tests with race detector (matches CI)
    run:
      - cmd: go test -v -race -coverprofile=coverage.txt -covermode=atomic ./...

  coverage:
    desc: Generate and open HTML coverage report
    run:
      - cmd: go test -coverprofile=coverage.txt ./...
      - cmd: go tool cover -html=coverage.txt -o coverage.html

  lint:
    desc: Run golangci-lint (matches CI)
    run:
      - cmd: golangci-lint run --config=.golangci.yaml --timeout=5m

  lint:fix:
    desc: Run golangci-lint and auto-fix issues
    run:
      - cmd: golangci-lint run --config=.golangci.yaml --timeout=5m --fix

  format:
    desc: Format code with gofmt
    run:
      - cmd: gofmt -w .

  format:check:
    desc: Check if code is formatted correctly
    run:
      - cmd: gofmt -l .

  hooks:install:
    desc: Install git hooks via lefthook
    run:
      - cmd: lefthook install

  hooks:uninstall:
    desc: Uninstall git hooks
    run:
      - cmd: lefthook uninstall
