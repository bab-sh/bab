min_version: 1.9.0

output:
  - meta
  - success
  - failure
  - summary

pre-commit:
  parallel: true
  commands:
    format:
      glob: "*.go"
      run: gofmt -l -w {staged_files} && goimports -w {staged_files}
      stage_fixed: true
      fail_text: "Formatting failed"

    vet:
      glob: "*.go"
      run: go vet ./...
      fail_text: "Go vet failed"

    tidy:
      glob: "*.go"
      run: go mod tidy && git diff --exit-code go.mod go.sum
      fail_text: "go.mod is not tidy. Run: go mod tidy"

    lint:
      glob: "*.go"
      run: golangci-lint run --config=".golangci.yaml" --new --timeout=5m
      fail_text: "Linting failed. Run: task lint:fix"

    test:
      glob: "*.go"
      run: go test -race ./...
      fail_text: "Tests failed"

commit-msg:
  commands:
    conventional-commit:
      run: .lefthook/commit-msg-check.sh {1}
      fail_text: "Invalid commit message format"

pre-push:
  commands:
    check:
      run: task check
      fail_text: "Pre-push checks failed. Run: task check"
